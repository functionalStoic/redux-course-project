<!DOCTYPE html>
<html lang="en">

<head>
  <title>Todos/Goals</title>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js'></script>
  <script src='https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js'></script>
  <script src='https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js'></script>
  <script src='https://unpkg.com/babel-standalone@6.15.0/babel.min.js'></script>
  <script src='./API.js'></script>
</head>

<body>
  <div id='app'></div>

  <script type="text/javascript" src="./index.js"></script>

  <script type="text/babel">
    const List = ({items, remove, toggle}) => 
      <ul>
        {items.map((item) => 
          <li key={item.id}>
            <span 
              onClick={()=> toggle && toggle(item.id) }
              style={{textDecoration: item.complete ? 'line-through': 'none'}}
            >
              {item.name}
            </span>
            <button onClick={() => remove(item)}>X</button>
          </li>
        )}
      </ul>

    
    class Todos extends React.Component {
      addItem = (e) => {
        e.preventDefault()
        const name = this.input.value
        this.input.value = ''

        this.props.store.dispatch(addTodoAction({
          id: generateId(),
          name,
          complete: false
        }))
      }

      removeItem = (todo) => {
        this.props.store.dispatch(removeTodoAction(todo.id))
      }

      toggleItem = (id) => this.props.store.dispatch(toggleTodoAction(id))

      render() {
        return (
          <div>
            <h1>Todo List</h1>
            <form>
              <input 
                type="text"
                placeholder="Add Todo"
                ref={(input) => this.input = input}
              />
              <button onClick={this.addItem}>Add Todo</button>
            </form>
            <List 
              items={this.props.todos}
              remove={this.removeItem}
              toggle={this.toggleItem}
            />
          </div>
        )
      }
    }
    

    class Goals extends React.Component {
      addItem = (e) => {
        e.preventDefault()
        const name = this.input.value
        this.input.value = ''

        this.props.store.dispatch(addGoalAction({
          id: generateId(),
          name
        }))
      }

      removeItem = (goal) => {
        this.props.store.dispatch(removeGoalAction(goal.id))
      }

      render() {
        return (
          <div>
            <h1>Goal List</h1>
            <form>
              <input 
                type="text"
                placeholder="Add Goal"
                ref={(input) => this.input = input}
              />
              <button onClick={this.addItem}>Add Goal</button>
            </form>
            <List
              items={this.props.goals}
              remove={this.removeItem}
            />
          </div>
        )
      }
    }
    
     
    class App extends React.Component {
      componentDidMount () {
        const {store} = this.props
        Promise.all([
          API.fetchTodos(),
          API.fetchGoals()
        ]).then(([todos, goals]) => {
          store.dispatch(receiveDataAction(todos, goals))
        })

        store.subscribe(() => this.forceUpdate())
      }

      render() {
        const {store} = this.props
        const {todos, goals, loading} = store.getState()      
        
        
        if (loading === true) {
          return <h3>Loading...</h3>
        } else {
          return (
            <div>
              <Todos todos={todos} store={store} />
              <Goals goals={goals} store={store}/>
            </div>
          )
        }
      }
    } 

    ReactDOM.render(<App store={store}/>, document.getElementById('app'))
  </script>
</body>

</html>